{"ast":null,"code":"import { useCallback } from 'react';\nimport { nanoid } from 'nanoid';\nimport { useImageUploads } from './useImageUploads';\nimport { useFileUploads } from './useFileUploads';\nimport { useChannelStateContext } from '../../../context/ChannelStateContext';\nvar apiMaxNumberOfFiles = 10;\nexport var useAttachments = function (props, state, dispatch, textareaRef) {\n  var noFiles = props.noFiles;\n  var fileUploads = state.fileUploads,\n      imageUploads = state.imageUploads;\n\n  var _a = useChannelStateContext('useAttachments'),\n      maxNumberOfFiles = _a.maxNumberOfFiles,\n      multipleUploads = _a.multipleUploads;\n\n  var _b = useFileUploads(props, state, dispatch),\n      removeFile = _b.removeFile,\n      uploadFile = _b.uploadFile;\n\n  var _c = useImageUploads(props, state, dispatch),\n      removeImage = _c.removeImage,\n      uploadImage = _c.uploadImage; // Number of files that the user can still add. Should never be more than the amount allowed by the API.\n  // If multipleUploads is false, we only want to allow a single upload.\n\n\n  var maxFilesAllowed = !multipleUploads ? 1 : maxNumberOfFiles || apiMaxNumberOfFiles; // OG attachments should not be counted towards \"numberOfImages\"\n\n  var numberOfImages = Object.values(imageUploads).filter(function (_a) {\n    var og_scrape_url = _a.og_scrape_url,\n        state = _a.state;\n    return state !== 'failed' && !og_scrape_url;\n  }).length;\n  var numberOfFiles = Object.values(fileUploads).filter(function (_a) {\n    var state = _a.state;\n    return state !== 'failed';\n  }).length;\n  var numberOfUploads = numberOfImages + numberOfFiles;\n  var maxFilesLeft = maxFilesAllowed - numberOfUploads;\n  var uploadNewFiles = useCallback(function (files) {\n    var _a;\n\n    Array.from(files).slice(0, maxFilesLeft).forEach(function (file) {\n      var id = nanoid();\n\n      if (file.type.startsWith('image/') && !file.type.endsWith('.photoshop') // photoshop files begin with 'image/'\n      ) {\n        dispatch({\n          file: file,\n          id: id,\n          state: 'uploading',\n          type: 'setImageUpload'\n        });\n      } else if (file instanceof File && !noFiles) {\n        dispatch({\n          file: file,\n          id: id,\n          state: 'uploading',\n          type: 'setFileUpload'\n        });\n      }\n    });\n    (_a = textareaRef === null || textareaRef === void 0 ? void 0 : textareaRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n  }, [maxFilesLeft, noFiles]);\n  return {\n    maxFilesLeft: maxFilesLeft,\n    numberOfUploads: numberOfUploads,\n    removeFile: removeFile,\n    removeImage: removeImage,\n    uploadFile: uploadFile,\n    uploadImage: uploadImage,\n    uploadNewFiles: uploadNewFiles\n  };\n};","map":{"version":3,"names":["useCallback","nanoid","useImageUploads","useFileUploads","useChannelStateContext","apiMaxNumberOfFiles","useAttachments","props","state","dispatch","textareaRef","noFiles","fileUploads","imageUploads","_a","maxNumberOfFiles","multipleUploads","_b","removeFile","uploadFile","_c","removeImage","uploadImage","maxFilesAllowed","numberOfImages","Object","values","filter","og_scrape_url","length","numberOfFiles","numberOfUploads","maxFilesLeft","uploadNewFiles","files","Array","from","slice","forEach","file","id","type","startsWith","endsWith","File","current","focus"],"sources":["/Users/cherrie/Desktop/messenger_ver_2/client/node_modules/stream-chat-react/dist/components/MessageInput/hooks/useAttachments.js"],"sourcesContent":["import { useCallback } from 'react';\nimport { nanoid } from 'nanoid';\nimport { useImageUploads } from './useImageUploads';\nimport { useFileUploads } from './useFileUploads';\nimport { useChannelStateContext } from '../../../context/ChannelStateContext';\nvar apiMaxNumberOfFiles = 10;\nexport var useAttachments = function (props, state, dispatch, textareaRef) {\n    var noFiles = props.noFiles;\n    var fileUploads = state.fileUploads, imageUploads = state.imageUploads;\n    var _a = useChannelStateContext('useAttachments'), maxNumberOfFiles = _a.maxNumberOfFiles, multipleUploads = _a.multipleUploads;\n    var _b = useFileUploads(props, state, dispatch), removeFile = _b.removeFile, uploadFile = _b.uploadFile;\n    var _c = useImageUploads(props, state, dispatch), removeImage = _c.removeImage, uploadImage = _c.uploadImage;\n    // Number of files that the user can still add. Should never be more than the amount allowed by the API.\n    // If multipleUploads is false, we only want to allow a single upload.\n    var maxFilesAllowed = !multipleUploads ? 1 : maxNumberOfFiles || apiMaxNumberOfFiles;\n    // OG attachments should not be counted towards \"numberOfImages\"\n    var numberOfImages = Object.values(imageUploads).filter(function (_a) {\n        var og_scrape_url = _a.og_scrape_url, state = _a.state;\n        return state !== 'failed' && !og_scrape_url;\n    }).length;\n    var numberOfFiles = Object.values(fileUploads).filter(function (_a) {\n        var state = _a.state;\n        return state !== 'failed';\n    }).length;\n    var numberOfUploads = numberOfImages + numberOfFiles;\n    var maxFilesLeft = maxFilesAllowed - numberOfUploads;\n    var uploadNewFiles = useCallback(function (files) {\n        var _a;\n        Array.from(files)\n            .slice(0, maxFilesLeft)\n            .forEach(function (file) {\n            var id = nanoid();\n            if (file.type.startsWith('image/') &&\n                !file.type.endsWith('.photoshop') // photoshop files begin with 'image/'\n            ) {\n                dispatch({ file: file, id: id, state: 'uploading', type: 'setImageUpload' });\n            }\n            else if (file instanceof File && !noFiles) {\n                dispatch({ file: file, id: id, state: 'uploading', type: 'setFileUpload' });\n            }\n        });\n        (_a = textareaRef === null || textareaRef === void 0 ? void 0 : textareaRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n    }, [maxFilesLeft, noFiles]);\n    return {\n        maxFilesLeft: maxFilesLeft,\n        numberOfUploads: numberOfUploads,\n        removeFile: removeFile,\n        removeImage: removeImage,\n        uploadFile: uploadFile,\n        uploadImage: uploadImage,\n        uploadNewFiles: uploadNewFiles,\n    };\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}