{"ast":null,"code":"import { useCallback, useEffect, useLayoutEffect, useRef, useState } from 'react';\nimport { ResizeObserver as Polyfill } from '@juggle/resize-observer';\nimport { useMessageListScrollManager } from './useMessageListScrollManager';\nvar isBrowser = typeof window !== 'undefined';\nvar ResizeObserver = isBrowser && window.ResizeObserver || Polyfill;\nexport var useScrollLocationLogic = function (params) {\n  var _a = params.messages,\n      messages = _a === void 0 ? [] : _a,\n      _b = params.scrolledUpThreshold,\n      scrolledUpThreshold = _b === void 0 ? 200 : _b,\n      hasMoreNewer = params.hasMoreNewer,\n      suppressAutoscroll = params.suppressAutoscroll,\n      listElement = params.listElement,\n      ulElement = params.ulElement;\n\n  var _c = useState(false),\n      hasNewMessages = _c[0],\n      setHasNewMessages = _c[1];\n\n  var _d = useState(),\n      wrapperRect = _d[0],\n      setWrapperRect = _d[1];\n\n  var closeToBottom = useRef(false);\n  var closeToTop = useRef(false);\n  var scrollCounter = useRef({\n    autoScroll: 0,\n    scroll: 0\n  });\n  var scrollToBottom = useCallback(function () {\n    if (!(listElement === null || listElement === void 0 ? void 0 : listElement.scrollTo) || hasMoreNewer || suppressAutoscroll) {\n      return;\n    }\n\n    scrollCounter.current.autoScroll += 1;\n    listElement.scrollTo({\n      top: listElement.scrollHeight\n    });\n    setHasNewMessages(false);\n  }, [listElement, hasMoreNewer, suppressAutoscroll]);\n  useEffect(function () {\n    if (!listElement) return;\n    var observer = new ResizeObserver(scrollToBottom);\n\n    var cancelObserverOnUserScroll = function () {\n      scrollCounter.current.scroll += 1;\n      var userScrolled = scrollCounter.current.autoScroll < scrollCounter.current.scroll;\n\n      if (ulElement && userScrolled) {\n        observer.unobserve(ulElement);\n        listElement === null || listElement === void 0 ? void 0 : listElement.removeEventListener('scroll', cancelObserverOnUserScroll);\n      }\n    };\n\n    if (ulElement) {\n      observer.observe(ulElement);\n    }\n\n    listElement.addEventListener('scroll', cancelObserverOnUserScroll);\n    return function () {\n      observer.disconnect();\n\n      if (listElement) {\n        listElement.removeEventListener('scroll', cancelObserverOnUserScroll);\n      }\n    };\n  }, [ulElement, scrollToBottom]);\n  useLayoutEffect(function () {\n    if (listElement) {\n      setWrapperRect(listElement.getBoundingClientRect());\n      scrollToBottom();\n    }\n  }, [listElement, hasMoreNewer]);\n  var updateScrollTop = useMessageListScrollManager({\n    messages: messages,\n    onScrollBy: function (scrollBy) {\n      listElement === null || listElement === void 0 ? void 0 : listElement.scrollBy({\n        top: scrollBy\n      });\n    },\n    scrollContainerMeasures: function () {\n      return {\n        offsetHeight: (listElement === null || listElement === void 0 ? void 0 : listElement.offsetHeight) || 0,\n        scrollHeight: (listElement === null || listElement === void 0 ? void 0 : listElement.scrollHeight) || 0\n      };\n    },\n    scrolledUpThreshold: scrolledUpThreshold,\n    scrollToBottom: scrollToBottom,\n    showNewMessages: function () {\n      return setHasNewMessages(true);\n    }\n  });\n  var onScroll = useCallback(function (event) {\n    var element = event.target;\n    var scrollTop = element.scrollTop;\n    updateScrollTop(scrollTop);\n    var offsetHeight = element.offsetHeight;\n    var scrollHeight = element.scrollHeight;\n    closeToBottom.current = scrollHeight - (scrollTop + offsetHeight) < scrolledUpThreshold;\n    closeToTop.current = scrollTop < scrolledUpThreshold;\n\n    if (closeToBottom.current) {\n      setHasNewMessages(false);\n    }\n  }, [updateScrollTop, closeToTop, closeToBottom, scrolledUpThreshold]);\n  var onMessageLoadCaptured = useCallback(function () {\n    /**\n     * A load event (emitted by e.g. an <img>) was captured on a message.\n     * In some cases, the loaded asset is larger than the placeholder, which means we have to scroll down.\n     */\n    if (closeToBottom.current && !closeToTop.current) {\n      scrollToBottom();\n    }\n  }, [closeToTop, closeToBottom, scrollToBottom]);\n  return {\n    hasNewMessages: hasNewMessages,\n    listElement: listElement,\n    onMessageLoadCaptured: onMessageLoadCaptured,\n    onScroll: onScroll,\n    scrollToBottom: scrollToBottom,\n    wrapperRect: wrapperRect\n  };\n};","map":{"version":3,"names":["useCallback","useEffect","useLayoutEffect","useRef","useState","ResizeObserver","Polyfill","useMessageListScrollManager","isBrowser","window","useScrollLocationLogic","params","_a","messages","_b","scrolledUpThreshold","hasMoreNewer","suppressAutoscroll","listElement","ulElement","_c","hasNewMessages","setHasNewMessages","_d","wrapperRect","setWrapperRect","closeToBottom","closeToTop","scrollCounter","autoScroll","scroll","scrollToBottom","scrollTo","current","top","scrollHeight","observer","cancelObserverOnUserScroll","userScrolled","unobserve","removeEventListener","observe","addEventListener","disconnect","getBoundingClientRect","updateScrollTop","onScrollBy","scrollBy","scrollContainerMeasures","offsetHeight","showNewMessages","onScroll","event","element","target","scrollTop","onMessageLoadCaptured"],"sources":["/Users/cherrie/Desktop/messenger_ver_2/client/node_modules/stream-chat-react/dist/components/MessageList/hooks/useScrollLocationLogic.js"],"sourcesContent":["import { useCallback, useEffect, useLayoutEffect, useRef, useState } from 'react';\nimport { ResizeObserver as Polyfill } from '@juggle/resize-observer';\nimport { useMessageListScrollManager } from './useMessageListScrollManager';\nvar isBrowser = typeof window !== 'undefined';\nvar ResizeObserver = (isBrowser && window.ResizeObserver) || Polyfill;\nexport var useScrollLocationLogic = function (params) {\n    var _a = params.messages, messages = _a === void 0 ? [] : _a, _b = params.scrolledUpThreshold, scrolledUpThreshold = _b === void 0 ? 200 : _b, hasMoreNewer = params.hasMoreNewer, suppressAutoscroll = params.suppressAutoscroll, listElement = params.listElement, ulElement = params.ulElement;\n    var _c = useState(false), hasNewMessages = _c[0], setHasNewMessages = _c[1];\n    var _d = useState(), wrapperRect = _d[0], setWrapperRect = _d[1];\n    var closeToBottom = useRef(false);\n    var closeToTop = useRef(false);\n    var scrollCounter = useRef({ autoScroll: 0, scroll: 0 });\n    var scrollToBottom = useCallback(function () {\n        if (!(listElement === null || listElement === void 0 ? void 0 : listElement.scrollTo) || hasMoreNewer || suppressAutoscroll) {\n            return;\n        }\n        scrollCounter.current.autoScroll += 1;\n        listElement.scrollTo({\n            top: listElement.scrollHeight,\n        });\n        setHasNewMessages(false);\n    }, [listElement, hasMoreNewer, suppressAutoscroll]);\n    useEffect(function () {\n        if (!listElement)\n            return;\n        var observer = new ResizeObserver(scrollToBottom);\n        var cancelObserverOnUserScroll = function () {\n            scrollCounter.current.scroll += 1;\n            var userScrolled = scrollCounter.current.autoScroll < scrollCounter.current.scroll;\n            if (ulElement && userScrolled) {\n                observer.unobserve(ulElement);\n                listElement === null || listElement === void 0 ? void 0 : listElement.removeEventListener('scroll', cancelObserverOnUserScroll);\n            }\n        };\n        if (ulElement) {\n            observer.observe(ulElement);\n        }\n        listElement.addEventListener('scroll', cancelObserverOnUserScroll);\n        return function () {\n            observer.disconnect();\n            if (listElement) {\n                listElement.removeEventListener('scroll', cancelObserverOnUserScroll);\n            }\n        };\n    }, [ulElement, scrollToBottom]);\n    useLayoutEffect(function () {\n        if (listElement) {\n            setWrapperRect(listElement.getBoundingClientRect());\n            scrollToBottom();\n        }\n    }, [listElement, hasMoreNewer]);\n    var updateScrollTop = useMessageListScrollManager({\n        messages: messages,\n        onScrollBy: function (scrollBy) {\n            listElement === null || listElement === void 0 ? void 0 : listElement.scrollBy({ top: scrollBy });\n        },\n        scrollContainerMeasures: function () { return ({\n            offsetHeight: (listElement === null || listElement === void 0 ? void 0 : listElement.offsetHeight) || 0,\n            scrollHeight: (listElement === null || listElement === void 0 ? void 0 : listElement.scrollHeight) || 0,\n        }); },\n        scrolledUpThreshold: scrolledUpThreshold,\n        scrollToBottom: scrollToBottom,\n        showNewMessages: function () { return setHasNewMessages(true); },\n    });\n    var onScroll = useCallback(function (event) {\n        var element = event.target;\n        var scrollTop = element.scrollTop;\n        updateScrollTop(scrollTop);\n        var offsetHeight = element.offsetHeight;\n        var scrollHeight = element.scrollHeight;\n        closeToBottom.current = scrollHeight - (scrollTop + offsetHeight) < scrolledUpThreshold;\n        closeToTop.current = scrollTop < scrolledUpThreshold;\n        if (closeToBottom.current) {\n            setHasNewMessages(false);\n        }\n    }, [updateScrollTop, closeToTop, closeToBottom, scrolledUpThreshold]);\n    var onMessageLoadCaptured = useCallback(function () {\n        /**\n         * A load event (emitted by e.g. an <img>) was captured on a message.\n         * In some cases, the loaded asset is larger than the placeholder, which means we have to scroll down.\n         */\n        if (closeToBottom.current && !closeToTop.current) {\n            scrollToBottom();\n        }\n    }, [closeToTop, closeToBottom, scrollToBottom]);\n    return {\n        hasNewMessages: hasNewMessages,\n        listElement: listElement,\n        onMessageLoadCaptured: onMessageLoadCaptured,\n        onScroll: onScroll,\n        scrollToBottom: scrollToBottom,\n        wrapperRect: wrapperRect,\n    };\n};\n"],"mappings":"AAAA,SAASA,WAAT,EAAsBC,SAAtB,EAAiCC,eAAjC,EAAkDC,MAAlD,EAA0DC,QAA1D,QAA0E,OAA1E;AACA,SAASC,cAAc,IAAIC,QAA3B,QAA2C,yBAA3C;AACA,SAASC,2BAAT,QAA4C,+BAA5C;AACA,IAAIC,SAAS,GAAG,OAAOC,MAAP,KAAkB,WAAlC;AACA,IAAIJ,cAAc,GAAIG,SAAS,IAAIC,MAAM,CAACJ,cAArB,IAAwCC,QAA7D;AACA,OAAO,IAAII,sBAAsB,GAAG,UAAUC,MAAV,EAAkB;EAClD,IAAIC,EAAE,GAAGD,MAAM,CAACE,QAAhB;EAAA,IAA0BA,QAAQ,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgB,EAAhB,GAAqBA,EAA1D;EAAA,IAA8DE,EAAE,GAAGH,MAAM,CAACI,mBAA1E;EAAA,IAA+FA,mBAAmB,GAAGD,EAAE,KAAK,KAAK,CAAZ,GAAgB,GAAhB,GAAsBA,EAA3I;EAAA,IAA+IE,YAAY,GAAGL,MAAM,CAACK,YAArK;EAAA,IAAmLC,kBAAkB,GAAGN,MAAM,CAACM,kBAA/M;EAAA,IAAmOC,WAAW,GAAGP,MAAM,CAACO,WAAxP;EAAA,IAAqQC,SAAS,GAAGR,MAAM,CAACQ,SAAxR;;EACA,IAAIC,EAAE,GAAGhB,QAAQ,CAAC,KAAD,CAAjB;EAAA,IAA0BiB,cAAc,GAAGD,EAAE,CAAC,CAAD,CAA7C;EAAA,IAAkDE,iBAAiB,GAAGF,EAAE,CAAC,CAAD,CAAxE;;EACA,IAAIG,EAAE,GAAGnB,QAAQ,EAAjB;EAAA,IAAqBoB,WAAW,GAAGD,EAAE,CAAC,CAAD,CAArC;EAAA,IAA0CE,cAAc,GAAGF,EAAE,CAAC,CAAD,CAA7D;;EACA,IAAIG,aAAa,GAAGvB,MAAM,CAAC,KAAD,CAA1B;EACA,IAAIwB,UAAU,GAAGxB,MAAM,CAAC,KAAD,CAAvB;EACA,IAAIyB,aAAa,GAAGzB,MAAM,CAAC;IAAE0B,UAAU,EAAE,CAAd;IAAiBC,MAAM,EAAE;EAAzB,CAAD,CAA1B;EACA,IAAIC,cAAc,GAAG/B,WAAW,CAAC,YAAY;IACzC,IAAI,EAAEkB,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACc,QAAxE,KAAqFhB,YAArF,IAAqGC,kBAAzG,EAA6H;MACzH;IACH;;IACDW,aAAa,CAACK,OAAd,CAAsBJ,UAAtB,IAAoC,CAApC;IACAX,WAAW,CAACc,QAAZ,CAAqB;MACjBE,GAAG,EAAEhB,WAAW,CAACiB;IADA,CAArB;IAGAb,iBAAiB,CAAC,KAAD,CAAjB;EACH,CAT+B,EAS7B,CAACJ,WAAD,EAAcF,YAAd,EAA4BC,kBAA5B,CAT6B,CAAhC;EAUAhB,SAAS,CAAC,YAAY;IAClB,IAAI,CAACiB,WAAL,EACI;IACJ,IAAIkB,QAAQ,GAAG,IAAI/B,cAAJ,CAAmB0B,cAAnB,CAAf;;IACA,IAAIM,0BAA0B,GAAG,YAAY;MACzCT,aAAa,CAACK,OAAd,CAAsBH,MAAtB,IAAgC,CAAhC;MACA,IAAIQ,YAAY,GAAGV,aAAa,CAACK,OAAd,CAAsBJ,UAAtB,GAAmCD,aAAa,CAACK,OAAd,CAAsBH,MAA5E;;MACA,IAAIX,SAAS,IAAImB,YAAjB,EAA+B;QAC3BF,QAAQ,CAACG,SAAT,CAAmBpB,SAAnB;QACAD,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACsB,mBAAZ,CAAgC,QAAhC,EAA0CH,0BAA1C,CAA1D;MACH;IACJ,CAPD;;IAQA,IAAIlB,SAAJ,EAAe;MACXiB,QAAQ,CAACK,OAAT,CAAiBtB,SAAjB;IACH;;IACDD,WAAW,CAACwB,gBAAZ,CAA6B,QAA7B,EAAuCL,0BAAvC;IACA,OAAO,YAAY;MACfD,QAAQ,CAACO,UAAT;;MACA,IAAIzB,WAAJ,EAAiB;QACbA,WAAW,CAACsB,mBAAZ,CAAgC,QAAhC,EAA0CH,0BAA1C;MACH;IACJ,CALD;EAMH,CAtBQ,EAsBN,CAAClB,SAAD,EAAYY,cAAZ,CAtBM,CAAT;EAuBA7B,eAAe,CAAC,YAAY;IACxB,IAAIgB,WAAJ,EAAiB;MACbO,cAAc,CAACP,WAAW,CAAC0B,qBAAZ,EAAD,CAAd;MACAb,cAAc;IACjB;EACJ,CALc,EAKZ,CAACb,WAAD,EAAcF,YAAd,CALY,CAAf;EAMA,IAAI6B,eAAe,GAAGtC,2BAA2B,CAAC;IAC9CM,QAAQ,EAAEA,QADoC;IAE9CiC,UAAU,EAAE,UAAUC,QAAV,EAAoB;MAC5B7B,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAAC6B,QAAZ,CAAqB;QAAEb,GAAG,EAAEa;MAAP,CAArB,CAA1D;IACH,CAJ6C;IAK9CC,uBAAuB,EAAE,YAAY;MAAE,OAAQ;QAC3CC,YAAY,EAAE,CAAC/B,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAAC+B,YAAvE,KAAwF,CAD3D;QAE3Cd,YAAY,EAAE,CAACjB,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACiB,YAAvE,KAAwF;MAF3D,CAAR;IAGlC,CARyC;IAS9CpB,mBAAmB,EAAEA,mBATyB;IAU9CgB,cAAc,EAAEA,cAV8B;IAW9CmB,eAAe,EAAE,YAAY;MAAE,OAAO5B,iBAAiB,CAAC,IAAD,CAAxB;IAAiC;EAXlB,CAAD,CAAjD;EAaA,IAAI6B,QAAQ,GAAGnD,WAAW,CAAC,UAAUoD,KAAV,EAAiB;IACxC,IAAIC,OAAO,GAAGD,KAAK,CAACE,MAApB;IACA,IAAIC,SAAS,GAAGF,OAAO,CAACE,SAAxB;IACAV,eAAe,CAACU,SAAD,CAAf;IACA,IAAIN,YAAY,GAAGI,OAAO,CAACJ,YAA3B;IACA,IAAId,YAAY,GAAGkB,OAAO,CAAClB,YAA3B;IACAT,aAAa,CAACO,OAAd,GAAwBE,YAAY,IAAIoB,SAAS,GAAGN,YAAhB,CAAZ,GAA4ClC,mBAApE;IACAY,UAAU,CAACM,OAAX,GAAqBsB,SAAS,GAAGxC,mBAAjC;;IACA,IAAIW,aAAa,CAACO,OAAlB,EAA2B;MACvBX,iBAAiB,CAAC,KAAD,CAAjB;IACH;EACJ,CAXyB,EAWvB,CAACuB,eAAD,EAAkBlB,UAAlB,EAA8BD,aAA9B,EAA6CX,mBAA7C,CAXuB,CAA1B;EAYA,IAAIyC,qBAAqB,GAAGxD,WAAW,CAAC,YAAY;IAChD;AACR;AACA;AACA;IACQ,IAAI0B,aAAa,CAACO,OAAd,IAAyB,CAACN,UAAU,CAACM,OAAzC,EAAkD;MAC9CF,cAAc;IACjB;EACJ,CARsC,EAQpC,CAACJ,UAAD,EAAaD,aAAb,EAA4BK,cAA5B,CARoC,CAAvC;EASA,OAAO;IACHV,cAAc,EAAEA,cADb;IAEHH,WAAW,EAAEA,WAFV;IAGHsC,qBAAqB,EAAEA,qBAHpB;IAIHL,QAAQ,EAAEA,QAJP;IAKHpB,cAAc,EAAEA,cALb;IAMHP,WAAW,EAAEA;EANV,CAAP;AAQH,CAxFM"},"metadata":{},"sourceType":"module"}